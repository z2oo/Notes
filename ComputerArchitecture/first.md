# 计算机系统结构的基本概念
## 计算机系统的层次结构
计算机系统是由硬件和软件组成的  

从使用语言的角度出发，可把计算机系统按功能划分为多级层次结构，每一层以一种不同的语言为特征  

- 第6级：应用语言机器(虚拟机)　　　高
- 第5级：高级语言机器(虚拟机)　　　｜
- 第4级：汇编语言机器(虚拟机)　　　｜
- 第3级：操作系统机器(虚拟机)　　　｜
- 第2级：传统机器语言机器(物理机)　｜
- 第1级：微程序机器(物理机)　　　　低
 
第1级：用微指令编写的微程序直接由**固件/硬件**来**解释**实现  
1级上可以有多个能够在它上面运行的**解释程序**，每个解释程序定义了一种指令`系统(仿真)，即在一台电脑上可实现多种指令系统  

第2级：即传统的**机器指令系统**，程序员用该系统编写的程序由第1级上的微程序进行**解释执行**  
        
第3级———传统机器级指令  
　　|———操作系统级指令----用于实现对操作系统功能的调用(打开/关闭文件、读/写文件等)  
这一级编写的程序是由第3级(自身)和第2级来共同执行的，其中，只有**操作系统级指令**是由**操作系统**进行**解释执行**的  

第4级：用汇编语言写的程序首先**翻译**成**第3级**和**第2级**语言，然后在用**相应的机器**执行。完成这个翻译的程序称为**汇编程序**  

第5级：用高级语言编写的程序一般由**编译器**翻译到**第4级**或**第3级**机器上的语言，个别的高级语言也用解释的方法实现(BASIC)  

第6级：这一级是为使计算机满足**某种用途**而设计的，因此这一级的语言就是各种面向具体应用问题的**应用语言**。一般由应用**程序包**翻译成第5级上的语言  

各机器级的实现主要靠**翻译**或**解释**，或两者结合  

翻译(translation)：即编译，先用转换程序把**高一级**机器上的程序**转换**为低一级机器上等效的程序，然后再在该**低一级**机器上运行，实现程序的功能  

解释(interpretation)：对于高一级机器上的程序的**每一条**语句或指令，都转去执行低一级机器上的等效代码。执行完毕后，再去高一级机器取下一条语句或指令，再进行**解释执行**，如此重复，直至解释执行整个程序  
  
一般，解释执行比编译后在执行所**花的时间多**，但占用的**存储空间较少**  

下面三级一般是用**解释实现**的，而上面三级一般用**翻译**的方法实现的  

最下面2级机器使用**硬件/固件**实现的，称为**物理机(Physical Machine)**  
上面4级一般由**软件**实现的，用**软件**实现的机器称为**虚拟机(Virtual Machine)**  
不过，虚拟机不一定完全由软件实现的，有些操作可以由**硬/固**实现  
  
> 固件(firmware)：是指具有软件功能的硬件。例如，把软件固化在只读存储器就是一种固件，通过修改固件的软件代码就可以改变其功能  
固件与硬连逻辑相比，固件的特点是灵活性大，但速度较慢  

## 计算机系统结构的定义
计算机系统结构(Computer Architecture)的经典定义：指传统机器程序员所看到的计算机属性，即概念性结构与功能特性。按照计算机系统的多级层次结构，不同级程序员所看到的计算机具有不同的属性  
例：  
**传统机器程序员**看到的主要属性是：该机器**指令系统**的功能特性，而**高级语言虚拟机程序员**所看到的主要属性则是：该机器所配置的**高级语言**所具有的功能特性  
  
不同的计算机系统，从**传统机器级**或**汇编语言程序员**的角度来看，具有不同的属性  
但，从高级语言程序员的角度来看，它们几乎没有什么差别，具有相同的属性  
也就是说，**这些传统机器级所存在的差别对于高级程序员来讲是“看不见的”**  

在计算机技术中，把这些**本来存在**的事物或属性，但从**某种角度看**又好像不存在的概念称为**透明性(transparency)**  

通常，在一个计算机系统中，低层机器的属性对高层机器的程序员来说，往往是透明的  
  
计算机系统结构的**实质**是：**确定计算机系统中软硬件的交界面，界面之上是软件实现的功能，界面之下是固和硬件实现的功能**  

## 计算机组成和计算机实现
**计算机组成(Computer Organization)**  
指的是计算机系统结构的**逻辑实现**，包括物理机器级中的**数据流**和**控制流**的组成以及**逻辑设计**等。它着眼与物理机器级内各事件的排序方式与控制方式、各部件的功能以及各部件之间的联系  
 
**计算机实现(Computer Implementation)**  
指的是**计算机组成**的**物理实现**，包括处理机、主存等部件的物理结构，器件的集成度和速度，模块、插件、底板的划分与连接，信号传输，电源、冷却及整机装配技术等。它着眼于器件技术和微组装技术，其中器件技术在实现技术中起主导作用  
  
例如  
1. 确定指令系统中**是否有乘法指令**属于**计算机系统结构**的内容，但乘法指令**是用专门的乘法器实现，还是用加法器经多步加法操作来实现**，属于**计算机组成**。而乘法器、加法器的**物理实现**，如器件的选定及所用的微组装技术等，属于**计算机实现**  
2. 主存容量与编址方式(按位、按字节或按字访问等)的确定属于**计算机系统结构**。为了达到给定的性能价格比，主存速度应多快、**逻辑结构**是否采用多体交叉等属于**计算机组成**。而主存系统的**物理实现**，如器件的选定、逻辑电路的设计、微组装技术的使用等均属于**计算机实现**  

## 计算机系统结构的分类
常见的计算机系统结构分类法有三种，**Flynn分类法**、**冯氏分类法**和Handler分类法  
### 1.Flynn分类法
Flynn分类法是按照**指令流**和**数据流**的**多倍性**进行分类的  
**指令流(Instruction Stream)**：计算机执行的指令序列  
**数据流(Data Stream)**：由指令流调用的数据序列  
**多倍性(Multiplicity)**：在系统最受限的部件上，同时处于同一执行阶段的指令或数据的最大数目  
  
Flynn分类法把计算机系统的结构分为以下4类：
1. **单指令流单数据流(SISD)**
2. **单指令流多数据流(SIMD)**
3. **多指令流单数据流(MISD)**
4. **多指令流多数据流(MIMD) ** 
 
SISD是传统的**顺序处理**计算机。SIMD以**阵列处理机**为代表。在SIMD计算机中，在同一控制部件的控制下，**多个处理部件**同时执行**同一条指令**所规定的操作，分别对各自的数据进行处理。这些数据来自不同的地方，分别构成各自的数据流。MISD只是一种人为的划分，没有实际的机器。**多处理机**属于MIMD机构  

### 2.冯氏分类法
冯氏分类法是用系统的**最大并行度**对计算机进行分类的。  
最大并行度Pm定义为：计算机系统在单位时间内能够处理的最大二进制位数  
根据分类，有以下4类：
1. **字串位串**：n=1，m=1.纯串行计算机
2. **字串位并**：n>1，m=1，传统的单处理机，同时处理单个字的多个位，如16位、32位等
3. **字并位串**：n=1，m>1。同时处理多个字的同一位(位片)
4. **字并位并**：n>1，m>1.同时处理多个字的多个位    

最大并行度**Pm=m\*n**  
与最大并行度密切相关的一个指标识平均并行度。假设每个时钟周期内能同时处理的二进制位数为Pi，则T个时钟周期内的平均并行度为pa=Pi(i=1，2，3)的和 / T 。平均并行度不同于最大并行度，它取决于系统的运行程度，与应用程序有关。  
系统在T个时钟周期内的平均利用率定义为μ=Pa / Pm   
### 3.Handler分类法
略
  
# 计算机系统的设计
## 计算机系统设计的定量原理
### 1.以经常性事件为重点  
**加快经常性事件的处理速度**能显著提高整个计算机系统的性能  
例如  
在CPU中，两个数进行相加运算时，相加的结果有可能会出现溢出现象，但一般情况是不会发生溢出的，也就是说不经常发生溢出时经常性时间。因此应该按照不发生溢出的情况来进行性能优化设计。即使会使溢出情况下的处理速度变慢也没关系
### 2.Amdahl定律
Amdahl定律告诉我们：  
当对一个系统中的某个部件进行改进后，所能获得的整个系统性能的提高，受限于该部件的执行时间占总执行时间的百分比。  
它可以用来具体地计算：当对计算机系统中的某个部分进行改进后，所能获得的**加速度比**的大小  

加速比说明了改进后的计算机比改进前快了多少倍  
**加速比=系统性能(改进后) / 系统性能(改进前) =总执行时间(改进前) / 总执行时间(改进后)**   

这个加速比的大小与两个因素有关  

1. 一个是在改进前的系统中，可改进部分的执行时间在总的执行时间中所占的比例，简称 可改进比例，记为 Fe。Fe总是小于1的  

2. 另一个是可改进部件改进以后性能提高的倍数。它是改进前所需要的执行时间与改进后执行时间的比，简称部件加速比，记为Se。Se总是大于1  

